<div class="review-container">
  <h3>Recenzije</h3>

  <!-- Ako korisnik već ima recenziju, prikazuje se -->
  <div *ngIf="userReview as review; else addReviewForm" class="user-review">
    <div *ngIf="!isEditing">
      <p class="review-author">{{ review.reviewFrom.fullName }}</p>
      <p class="review-rating">{{ review.rating }} ★</p>
      <p class="review-comment">{{ review.comment }}</p>
    </div>

    <form *ngIf="isEditing" (ngSubmit)="updateReview(review.id)">
      <textarea [(ngModel)]="editedReview.comment" placeholder="Ažurirajte komentar..." name="edit-comment"></textarea>
      <select [(ngModel)]="editedReview.rating" name="edit-rating">
        <option *ngFor="let r of [1, 2, 3, 4, 5]" [value]="r">{{ r }} ★</option>
      </select>
      <button type="submit">Sačuvaj</button>
      <button type="button" (click)="isEditing = false">Otkaži</button>
    </form>

    <div class="review-actions">
      <button (click)="toggleEditMode()">✏️ Izmeni</button>
      <button class="delete-btn" (click)="deleteReview(review.id)">🗑️ Obriši</button>
    </div>
  </div>

  <!-- Forma za dodavanje recenzije ako korisnik nema -->
  <ng-template #addReviewForm>
    <div class="review-form">
      <textarea [(ngModel)]="newReview.comment" placeholder="Ostavite komentar..."></textarea>
      <select [(ngModel)]="newReview.rating">
        <option *ngFor="let r of [1, 2, 3, 4, 5]" [value]="r">{{ r }} ★</option>
      </select>
      <button (click)="submitReview()">Dodaj recenziju</button>
    </div>
  </ng-template>

  <!-- Lista svih recenzija -->
  <div class="review-list">
    <div *ngFor="let review of reviews$ | async" class="review-card">
      <p class="review-author">{{ review.reviewFrom.fullName }}</p>
      <p class="review-rating">{{ review.rating }} ★</p>
      <p class="review-comment">{{ review.comment }}</p>
    </div>
  </div>
</div>
